# ApplicationLogger Bundle Configuration Example
# Copy this file to your project's config/packages/application_logger.yaml

application_logger:
    # REQUIRED: Data Source Name - Project endpoint URL
    # Get this from your ApplicationLogger dashboard when creating a project
    # Format: https://your-host.com/project-id
    dsn: '%env(APPLICATION_LOGGER_DSN)%'

    # REQUIRED: API Key for authentication
    # Get this from your ApplicationLogger dashboard (Project Settings > API Keys)
    api_key: '%env(APPLICATION_LOGGER_API_KEY)%'

    # Enable/disable error tracking globally
    enabled: true

    # Application version/release identifier (optional)
    # Useful for tracking errors across deployments
    release: null # e.g., 'v1.2.3' or '%env(APP_VERSION)%'

    # Environment name
    environment: '%kernel.environment%' # production, staging, development, etc.

    # Performance & Resilience Configuration
    # Maximum timeout for API requests in seconds (default: 2s for fast failure)
    timeout: 2.0

    # Number of retry attempts (0 = fail fast, recommended for resilience)
    retry_attempts: 0

    # Circuit Breaker - prevents cascade failures when API is down
    circuit_breaker:
        enabled: true
        failure_threshold: 5  # Open circuit after 5 consecutive failures
        timeout: 60           # Keep circuit open for 60 seconds
        half_open_attempts: 1 # Allow 1 test request in half-open state

    # Capture Settings
    # Minimum Monolog level to capture
    capture_level: error # debug|info|notice|warning|error|critical|alert|emergency

    # Field names to scrub from error data (security)
    scrub_fields:
        - password
        - token
        - api_key
        - secret
        - authorization
        - credit_card
        - ssn

    # Maximum number of breadcrumbs to track
    max_breadcrumbs: 50

    # JavaScript SDK Configuration - ZERO CONFIG BY DEFAULT!
    javascript:
        # Enable JavaScript error tracking
        enabled: true

        # Automatically inject JavaScript SDK on all HTML pages
        # Set to false if you want manual control via {{ application_logger_init() }}
        auto_inject: true

        # Enable JavaScript SDK debug mode (console.log)
        debug: false # Set to true for troubleshooting

        # Environment name for JavaScript errors (defaults to kernel.environment)
        environment: null # or override with specific value

        # Release version for JavaScript errors (defaults to root release config)
        release: null # or override with specific value

        # Additional fields to scrub in JavaScript errors
        # These are MERGED with the root scrub_fields
        scrub_fields: []
            # - custom_field
            # - another_field

    # Session Tracking Configuration
    # Required for session replay and analytics
    session_tracking:
        # Enable automatic session tracking (GDPR-compliant using session hashes)
        # Default: true (required for session replay functionality)
        enabled: true

        # Automatically track page views as session events
        track_page_views: true

        # Session idle timeout in seconds (default: 30 minutes)
        idle_timeout: 1800

        # Route names to ignore for session tracking
        ignored_routes:
            - '_profiler'
            - '_wdt'
            - '_preview_error'

        # URL paths to ignore for session tracking (prefix match)
        ignored_paths:
            - '/api/'
            - '/_fragment'
            - '/healthcheck'

    # Session Replay Configuration
    # Records user interactions (clicks + DOM structure) for error debugging
    # PRIVACY-FIRST: NO text content, NO form values, NO PII - only visual structure
    session_replay:
        # Enable session replay recording
        # Default: true
        enabled: true

        # Recording is ERROR-TRIGGERED: only captures when errors occur
        # Buffers clicks/interactions before and after errors for context

        # Buffer BEFORE error occurs (time-based, in seconds)
        # Captures the X seconds of activity BEFORE an error happens
        # Default: 30 seconds, Maximum: 60 seconds
        buffer_before_error_seconds: 30

        # Buffer BEFORE error occurs (click-based)
        # Captures the last X clicks BEFORE an error happens
        # Default: 10 clicks, Maximum: 15 clicks
        buffer_before_error_clicks: 10

        # Buffer AFTER error occurs (time-based, in seconds)
        # Continues recording for X seconds AFTER an error to see user reaction
        # Default: 30 seconds, Maximum: 60 seconds
        buffer_after_error_seconds: 30

        # Buffer AFTER error occurs (click-based)
        # Continues recording for X clicks AFTER an error
        # Default: 10 clicks, Maximum: 15 clicks
        buffer_after_error_clicks: 10

        # Click event debouncing (milliseconds between recorded clicks)
        # Prevents localStorage spam from rapid clicking (e.g., 100 clicks/second)
        # Only records 1 click per debounce period for performance
        # Default: 1000ms (1 second), Minimum: 100ms, Maximum: 5000ms
        click_debounce_ms: 1000

        # DOM snapshot throttling (milliseconds between captures)
        # Limits frequency of DOM structure captures for performance
        # Default: 1000ms (1 second), Minimum: 500ms, Maximum: 5000ms
        snapshot_throttle_ms: 1000

        # Maximum snapshot size (bytes, before compression)
        # Prevents excessive memory/bandwidth usage
        # Default: 1048576 (1MB)
        max_snapshot_size: 1048576

        # Cross-page session timeout (minutes of inactivity)
        # Session expires after this many minutes without activity
        # Allows session replay to span multiple page navigations
        # Default: 30 minutes
        session_timeout_minutes: 30

        # localStorage quota management (megabytes)
        # Maximum localStorage space used for buffering
        # Default: 5MB
        max_buffer_size_mb: 5

        # Expose API to developers for user control
        # Allows developers to let users disable session replay via UI
        # Methods available: window.ApplicationLogger.sessionReplay.disable()
        #                   window.ApplicationLogger.sessionReplay.enable()
        #                   window.ApplicationLogger.sessionReplay.isEnabled()
        # Default: true
        expose_api: true

    # Advanced Options
    # Use async HTTP client (fire-and-forget for maximum resilience)
    async: true

    # Enable PHP debug logging
    debug: false

# Environment Variables (.env or .env.local)
# Add these to your .env.local file (do not commit!):
#
# APPLICATION_LOGGER_DSN=https://your-host.com/your-project-id
# APPLICATION_LOGGER_API_KEY=your-api-key
